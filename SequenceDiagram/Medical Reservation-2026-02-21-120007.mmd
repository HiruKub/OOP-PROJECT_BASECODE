---
config:
  look: neo
  theme: redux-dark-color
---
sequenceDiagram
    actor Customer
    participant Clinic
    participant CustomerClass
    participant Pet
    participant Doctor
    participant WorkSchedule
    participant Reservation
    participant Notification
    autonumber
    
    Customer->>+Clinic: create_reservation(customer_id, pet_id, "Medical", time)
    
    loop search customer
        Clinic->>+CustomerClass: get_customer_info(customer_id)
        CustomerClass-->>-Clinic: return Customer
    end
    
    loop search pet
        Clinic ->>+ Pet: get_pet_info(pet_id)
        Pet -->>- Clinic: return Pet
    end
    
    Clinic->>+Doctor: get_avaliable_work(time)
    Doctor->>+WorkSchedule: search_availability(time)
    WorkSchedule-->>-Doctor: return True
    Doctor-->>-Clinic: return True
    
    Clinic->>+Doctor: update_timeslot(time)
    Doctor->>+WorkSchedule: update_schedule(time)
    WorkSchedule-->>-Doctor: return True
    Doctor-->>-Clinic: return True

    alt resource != None (มีคิวหมอว่าง)
        Clinic->>Reservation: create MedicalReservation()
        Clinic->>Clinic: __reservation.append(new_reservation)
        Clinic->>Customer: add_reservation(new_reservation)

        alt customer.email != None
            Clinic->>+Notification: send_confirmation("EMAIL", reservation_id)
            Notification-->>Clinic: return True
            Notification -->>- Customer: return Notification 
        else customer.phone != None
            Clinic->>+Notification: send_confirmation("SMS", reservation_id)
            Notification-->>Clinic: return True
            Notification -->>- Customer: return Notification
        end
        
        Clinic-->>Customer: return {"status": "success", ...}
    else resource == None (คิวหมอเต็ม)
        Clinic-->>-Customer: return {"status": "fail", ...}
    end